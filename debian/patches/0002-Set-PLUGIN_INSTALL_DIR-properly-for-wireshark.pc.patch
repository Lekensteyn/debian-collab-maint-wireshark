From e338ac048311209fde4e1786c45cf73bbf766f38 Mon Sep 17 00:00:00 2001
From: Balint Reczey <balint@balintreczey.hu>
Date: Thu, 29 May 2014 00:32:20 +0700
Subject: [PATCH] Set PLUGIN_INSTALL_DIR properly for wireshark.pc

Change-Id: I64c04095ce780ce2cc44a54a68695506d27e5747
---
 CMakeLists.txt      | 4 ++--
 cmakeconfig.h.in    | 5 +----
 configure.ac        | 2 +-
 wsutil/filesystem.c | 4 ++--
 4 files changed, 6 insertions(+), 9 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 44346721..7a19049 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -689,8 +689,8 @@ set_property(GLOBAL PROPERTY USE_FOLDERS ON)
 
 if(ENABLE_PLUGINS)
 	set(HAVE_PLUGINS 1)
-	set(PLUGIN_DIR="${DATAFILE_DIR}/plugins/${CPACK_PACKAGE_VERSION}")
-	set(PLUGIN_INSTALL_DIR="${CMAKE_INSTALL_LIBDIR}/@CPACK_PACKAGE_NAME@/plugins/${CPACK_PACKAGE_VERSION}")
+	set(PLUGIN_DIR "${DATAFILE_DIR}/plugins/${CPACK_PACKAGE_VERSION}")
+	set(PLUGIN_INSTALL_DIR "${CMAKE_INSTALL_LIBDIR}/@CPACK_PACKAGE_NAME@/plugins/${CPACK_PACKAGE_VERSION}")
 	set(PLUGIN_SRC_DIRS
 		plugins/docsis
 		plugins/ethercat
diff --git a/cmakeconfig.h.in b/cmakeconfig.h.in
index 0f64dce..a809e77 100644
--- a/cmakeconfig.h.in
+++ b/cmakeconfig.h.in
@@ -18,9 +18,6 @@
 /* Path to Python. */
 #cmakedefine PYTHON_DIR "${CMAKE_INSTALL_PREFIX}/${CMAKE_INSTALL_DATADIR}/${CPACK_PACKAGE_NAME}/python/${CPACK_PACKAGE_VERSION}"
 
-/* Directory where plugins reside */
-#define PLUGIN_DIR "${CMAKE_INSTALL_PREFIX}/${CMAKE_INSTALL_LIBDIR}/@CPACK_PACKAGE_NAME@/plugins/${CPACK_PACKAGE_VERSION}"
-
 /* Define to 1 if we want to enable plugins */
 #cmakedefine HAVE_PLUGINS 1
 
@@ -349,7 +346,7 @@
 #cmakedefine PCAP_NG_DEFAULT 1
 
 /* Plugin installation directory */
-#cmakedefine PLUGIN_DIR
+#cmakedefine PLUGIN_INSTALL_DIR "${PLUGIN_INSTALL_DIR}"
 
 /* Define if we are using version of of the Portaudio library API */
 #cmakedefine PORTAUDIO_API_1 1
diff --git a/configure.ac b/configure.ac
index 2485523..f060de6 100644
--- a/configure.ac
+++ b/configure.ac
@@ -2680,7 +2680,7 @@ then
   AC_DEFINE(HAVE_PLUGINS, 1, [Define if plugins are enabled])
 fi
 AC_SUBST(plugindir)
-CPPFLAGS="$CPPFLAGS '-DPLUGIN_DIR=\"\$(plugindir)\"'"
+CPPFLAGS="$CPPFLAGS '-DPLUGIN_INSTALL_DIR=\"\$(plugindir)\"'"
 
 #
 # The plugin dissectors reside in ./plugins/PROTO/
diff --git a/wsutil/filesystem.c b/wsutil/filesystem.c
index 1a316e2..e98a291 100644
--- a/wsutil/filesystem.c
+++ b/wsutil/filesystem.c
@@ -1069,7 +1069,7 @@ get_wspython_dir(void)
  *
  * On Windows, we use the "plugin" subdirectory of the datafile directory.
  *
- * On UN*X, we use the PLUGIN_DIR value supplied by the configure
+ * On UN*X, we use the PLUGIN_INSTALL_DIR value supplied by the configure
  * script, unless we think we're being run from the build directory,
  * in which case we use the "plugin" subdirectory of the datafile directory.
  *
@@ -1153,7 +1153,7 @@ init_plugin_dir(void)
         }
 #endif
         else {
-            plugin_dir = PLUGIN_DIR;
+            plugin_dir = PLUGIN_INSTALL_DIR;
         }
     }
 #endif
-- 
1.9.1

