#! /bin/sh /usr/share/dpatch/dpatch-run
## 21_CVE-2008-3934.dpatch by  <andete@debian.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: No description.

@DPATCH@
diff -urNad lenny~/epan/dissectors/packet-k12.c lenny/epan/dissectors/packet-k12.c
--- lenny~/epan/dissectors/packet-k12.c	2008-07-10 19:39:24.000000000 +0200
+++ lenny/epan/dissectors/packet-k12.c	2008-09-17 18:24:26.000000000 +0200
@@ -275,12 +275,10 @@
 		if (handles[i] == sscop_handle) {
 			sscop_payload_info *p_sscop_info = p_get_proto_data(pinfo->fd, proto_sscop);
 			if (!p_sscop_info) {
-				p_sscop_info = ep_alloc0(sizeof(sscop_payload_info));
-				if (p_sscop_info)
+				p_sscop_info = se_alloc0(sizeof(sscop_payload_info));
 					p_add_proto_data(pinfo->fd, proto_sscop, p_sscop_info);
-			}
-			if (p_sscop_info)
 				p_sscop_info->subdissector = handles[i+1];
+			}
 		}
 		/* Add more protocols here */
 	}
@@ -291,14 +289,13 @@
 	if (sub_handle == fp_handle) {
 		fp_info *p_fp_info = p_get_proto_data(pinfo->fd, proto_fp);
 		if (!p_fp_info) {
-			p_fp_info = ep_alloc0(sizeof(fp_info));
-			if (p_fp_info)
+			p_fp_info = se_alloc0(sizeof(fp_info));
 				p_add_proto_data(pinfo->fd, proto_fp, p_fp_info);
-		}
 
 		fill_fp_info(p_fp_info,
 			     pinfo->pseudo_header->k12.extra_info,
 			     pinfo->pseudo_header->k12.extra_length);
+		}
 	}
 
 	call_dissector(sub_handle, tvb, pinfo, tree);
