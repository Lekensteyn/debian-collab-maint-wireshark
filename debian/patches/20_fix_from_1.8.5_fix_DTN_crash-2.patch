From baa8a1e91106259ce1a80e2a8548570fefaa7540 Mon Sep 17 00:00:00 2001
From: Jeff Morriss <jeff.morriss.ws@gmail.com>
Date: Tue, 18 Dec 2012 02:20:38 +0000
Subject: [PATCH 08/16] Get rid of another tvb_get_ptr() abuse (just like
 r46577 but in a different function).

svn path=/trunk/; revision=46579
---
 epan/dissectors/packet-dtn.c |   12 +++++++-----
 1 file changed, 7 insertions(+), 5 deletions(-)

diff --git a/epan/dissectors/packet-dtn.c b/epan/dissectors/packet-dtn.c
index ac732d0..e834b02 100644
--- a/epan/dissectors/packet-dtn.c
+++ b/epan/dissectors/packet-dtn.c
@@ -1077,7 +1077,6 @@ dissect_version_5_and_6_primary_header(packet_info *pinfo,
 {
     guint64 bundle_processing_control_flags;
     guint8 cosflags;
-    const guint8 *dict_ptr;
     int bundle_header_length;
     int bundle_header_dict_length;
     int offset;         /*Total offset into frame (frame_offset + convergence layer size)*/
@@ -1521,12 +1520,15 @@ dissect_version_5_and_6_primary_header(packet_info *pinfo,
          */
 
         /* Note: If we get this far, the offsets (and the strings) are at least within the TVB */
-        dict_ptr = tvb_get_ptr(tvb, offset, bundle_header_dict_length);
         col_add_fstr(pinfo->cinfo, COL_INFO, "%s:%s > %s:%s",
-                     dict_ptr + source_scheme_offset, dict_ptr + source_ssp_offset,
-                     dict_ptr + dest_scheme_offset, dict_ptr + dest_ssp_offset);
+                     tvb_get_ephemeral_stringz(tvb, offset + source_scheme_offset, NULL),
+		     tvb_get_ephemeral_stringz(tvb, offset + source_ssp_offset, NULL),
+                     tvb_get_ephemeral_stringz(tvb, offset + dest_scheme_offset, NULL),
+		     tvb_get_ephemeral_stringz(tvb, offset + dest_ssp_offset, NULL));
         /* remember custodian, for use in checking cteb validity */
-        bundle_custodian = ep_strdup_printf("%s:%s", dict_ptr + cust_scheme_offset, dict_ptr + cust_ssp_offset);
+        bundle_custodian = ep_strdup_printf("%s:%s",
+                                            tvb_get_ephemeral_stringz(tvb, offset + cust_scheme_offset, NULL),
+                                            tvb_get_ephemeral_stringz(tvb, offset + cust_ssp_offset, NULL));
     }
     offset += bundle_header_dict_length;        /*Skip over dictionary*/
 
-- 
1.7.10.4

