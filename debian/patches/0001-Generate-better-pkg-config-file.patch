From ea16a84ef51b0e50a40789adcfbe71b6f3c60ed1 Mon Sep 17 00:00:00 2001
From: Michal Privoznik <miso.privoznik@gmail.com>
Date: Sat, 26 Dec 2015 17:13:00 +0100
Subject: [PATCH] Generate better pkg-config file
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Firstly, when building with autogen.sh and configure script, the
wireshark.pc is not generated at all. Then, due to not matching
names some variables are not being replaced as they should be.

Bug: 11069
Change-Id: Iefa7a9b536f3fee7f9ad78803aaacc5bb64a9c8d
Signed-off-by: Michal Privoznik <mprivozn@redhat.com>
Reviewed-on: https://code.wireshark.org/review/13005
Reviewed-by: Jo√£o Valverde <j@v6e.pt>
Petri-Dish: Alexis La Goutte <alexis.lagoutte@gmail.com>
Tested-by: Petri Dish Buildbot <buildbot-no-reply@wireshark.org>
Reviewed-by: Anders Broman <a.broman58@gmail.com>
---
 CMakeLists.txt  |  6 ++++++
 configure.ac    |  3 ++-
 wireshark.pc.in | 22 +++++++++++-----------
 3 files changed, 19 insertions(+), 12 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 22cf880..43ab266 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1158,6 +1158,12 @@ configure_file(${CMAKE_SOURCE_DIR}/cmakeconfig.h.in ${CMAKE_BINARY_DIR}/config.h
 configure_file(${CMAKE_SOURCE_DIR}/version.h.in ${CMAKE_BINARY_DIR}/version.h)
 #set_target_properties(${CMAKE_BINARY_DIR}/version.h PROPERTIES FOLDER "Auxiliary")
 
+set( prefix "${CMAKE_INSTALL_PREFIX}" )
+set( exec_prefix "\${prefix}" )
+set( libdir "\${exec_prefix}/${CMAKE_INSTALL_LIBDIR}" )
+set( includedir  "\${prefix}/include" )
+set( plugindir "\${libdir}/${PLUGIN_INSTALL_DIR}" )
+
 set(ICON_PATH "${CMAKE_SOURCE_DIR}/image/")
 set( IN_FILES
 	adns_dll.rc
diff --git a/configure.ac b/configure.ac
index 18dfb86..1bd920e 100644
--- a/configure.ac
+++ b/configure.ac
@@ -3043,7 +3043,7 @@ dnl check whether plugins should be enabled and, if they should be,
 dnl check for plugins directory - stolen from Amanda's configure.ac
 dnl
 dnl we don't wish to expand ${libdir} yet
-plugindir='${libdir}/wireshark/plugins/${VERSION}'
+plugindir="\${libdir}/wireshark/plugins/${VERSION}"
 AC_ARG_WITH(plugins,
   AC_HELP_STRING( [--with-plugins@<:@=DIR@:>@],
 		  [support plugins (installed in DIR, if supplied) @<:@default=yes, if possible@:>@]),
@@ -3172,6 +3172,7 @@ AC_OUTPUT(
   Makefile
   doxygen.cfg
   asn1/Makefile
+  wireshark.pc
   _CUSTOM_ASN1_AC_OUTPUT_
   asn1/acp133/Makefile
   asn1/acse/Makefile
diff --git a/wireshark.pc.in b/wireshark.pc.in
index 826b230..5889178 100644
--- a/wireshark.pc.in
+++ b/wireshark.pc.in
@@ -1,14 +1,14 @@
-prefix=@CMAKE_INSTALL_PREFIX@
-exec_prefix=${prefix}
-libdir=@ABSOLUTE_CMAKE_INSTALL_LIBDIR@
+prefix=@prefix@
+exec_prefix=@exec_prefix@
+libdir=@libdir@
+includedir=@includedir@
 sharedlibdir=${libdir}
-includedir=${prefix}/include/wireshark
-plugindir=@PLUGIN_INSTALL_DIR@
+plugindir=@plugindir@
 
-Name: wireshark
-Description: wireshark network packet dissection library
-Version: @PROJECT_VERSION@
+Name: Wireshark
+Description: Network Packet Dissection Library
+Version: @VERSION@
 
-Requires:
-Libs: -L${libdir} -L${sharedlibdir} -lwireshark
-Cflags: -I${includedir}
+Requires: glib-2.0, gmodule-2.0, gthread-2.0
+Libs: -L${libdir} -lwireshark
+Cflags: -I${includedir}/wireshark
-- 
2.1.4

