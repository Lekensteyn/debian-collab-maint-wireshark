#! /bin/sh /usr/share/dpatch/dpatch-run
## CVE-2007-6450
##
## All lines beginning with `## DP:' are a description of the patch.

@DPATCH@
--- wireshark-0.99.4.orig/epan/dissectors/packet-rpl.c	2007/11/30 15:37:21	23686
+++ wireshark-0.99.4/epan/dissectors/packet-rpl.c	2007/11/30 15:55:28	23687
@@ -148,11 +148,16 @@
 				reported_length = tvb_reported_length_remaining(tvb, offset);
 				if (reported_length > sublen)
 					reported_length = sublen;
-				dissect_rpl_container(tvb_new_subset(tvb, 
+				if ( length > 0) {
+				  dissect_rpl_container(tvb_new_subset(tvb, 
 					offset, length, reported_length),
 					pinfo, rpl_container_tree);
-
-				offset += sublen;
+				  offset += reported_length;
+				} else {
+				  /* no more data, exit the loop */
+				  offset += reported_length;
+				  break;
+				}
 			}	
 			break;
 
