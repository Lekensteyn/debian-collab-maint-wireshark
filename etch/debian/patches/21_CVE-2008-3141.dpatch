#! /bin/sh /usr/share/dpatch/dpatch-run
## CVE-2008-3141
##
## All lines beginning with `## DP:' are a description of the patch.

@DPATCH@
diff -aur wireshark-0.99.4.orig/epan/dissectors/packet-rmi.c wireshark-0.99.4/epan/dissectors/packet-rmi.c
--- wireshark-0.99.4.orig/epan/dissectors/packet-rmi.c	2006-10-31 18:59:08.000000000 +0100
+++ wireshark-0.99.4/epan/dissectors/packet-rmi.c	2008-11-29 11:23:55.000000000 +0100
@@ -125,7 +125,8 @@
 
     rmi_type   rmitype;
 
-    char epid_hostname[256];
+    char *epid_hostname;
+	guint epid_len;
 
     offset     = 0;
     rmitype    = 0;
@@ -202,18 +203,15 @@
 		len = tvb_get_ntohs(tvb, 1);
 		proto_tree_add_uint(rmi_tree, hf_rmi_epid_length,
 				       tvb, offset + 1, 2, len);
-		memset(epid_hostname, 0, sizeof(epid_hostname));
-		if (len < sizeof(epid_hostname)) {
-		    strncpy(epid_hostname,tvb_get_ptr(tvb, offset + 3, len),
-			    sizeof(epid_hostname));
+		epid_len = len < ITEM_LABEL_LENGTH ? len : ITEM_LABEL_LENGTH;
+		if (epid_len > 0) {
+			epid_hostname = tvb_format_text(tvb, offset + 3, epid_len);
 		} else {
-		    strncpy(epid_hostname,
-			    "<string too long>", sizeof(epid_hostname));
+			epid_hostname = "[Empty]";
 		}
 		epid_hostname[sizeof(epid_hostname)-1] = '\0';
 		proto_tree_add_string(rmi_tree, hf_rmi_epid_hostname,
-				      tvb, offset + 3, strlen(epid_hostname),
-				      epid_hostname);
+				      tvb, offset + 3, epid_len, epid_hostname);
 
 		port = tvb_get_ntohs(tvb, offset + len + 5);
   		proto_tree_add_uint(rmi_tree, hf_rmi_epid_port,
Only in wireshark-0.99.4/epan/dissectors: packet-rmi.c~
