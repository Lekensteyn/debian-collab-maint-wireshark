#! /bin/sh /usr/share/dpatch/dpatch-run
## CVE-2007-6451
##
## All lines beginning with `## DP:' are a description of the patch.

@DPATCH@
--- wireshark-0.99.4.orig/epan/dissectors/packet-cip.c	2007/12/09 21:10:25	23819
+++ wireshark-0.99.4/epan/dissectors/packet-cip.c	2007/12/10 03:12:11	23820
@@ -405,6 +405,9 @@
       tmp2_length = ( length * 2 ) + 1;
    }
 
+
+   /* Throw an exception if tmp_length is negative */
+   tvb_ensure_bytes_exist( tvb, start, tmp_length );
    tmp = tvb_get_ptr( tvb, start, tmp_length );
    tmp2 = (char*)ep_alloc( tmp2_length );
 
